# User Story 009.2: Implement Diary Entry Form - Part 2 (Complex Fields)

## 1. Title

Implement the complex diary entry fields (location, company, emotions, behavior, skipped meal toggle, and entry type chips) with the shared UI package.

## 2. Goal

Complete the diary entry experience by wiring up the remaining non-text inputs—entry type, location/company selects, emotion chips, and behavior chips—so that the form captures the richer metadata we need for each moment.

## 3. Description

As a developer, I expanded the `TraditionalForm` so the `EntryForm` can capture the user’s entry type, who they were with, where the moment happened, how they felt, and whether any behaviors like skipping a meal occurred. Every option is defined centrally and localized through the taxonomy files.

## 4. Technical Details

- Option arrays for entry type, location, company, and behavior live in [apps/food-diary/src/components/EntryForm/utils/options.ts](apps/food-diary/src/components/EntryForm/utils/options.ts) and map to taxonomy keys for translations.
- `EntryForm` uses `ChipSelector` for the entry type and for picking behaviors so multiple selections and the special `skipped meal` flag are easy to handle.
- Locations and companies are rendered with `Select` plus optional "other" `TextArea`s; `EmotionPicker` handles multi-select emotions, and `ToggleButtonGroup` keeps the bookmark toggle accessible.
- The `TraditionalForm` enforces that `foodEaten` is optional when the entry type is `moment` or when the user picked the `skipped meal` behavior but remains required otherwise.
- All taxonomy strings (entry types, locations, companies, emotions, behaviors) are sourced from [apps/food-diary/messages/en/entry/taxonomy.json](apps/food-diary/messages/en/entry/taxonomy.json) and [apps/food-diary/messages/nl/entry/taxonomy.json](apps/food-diary/messages/nl/entry/taxonomy.json).

## 5. Steps to Implement

1. Define the option arrays in `options.ts`, including the `skipped meal` behavior and the `anders` fallback values.
2. Wrap the location/company selects with `toOptions` so each option resolves its localized label before rendering.
3. Add the `ChipSelector` controls for entry type and behavior, allowing one selection for entry type and multiple for behavior, and handle the `behaviorOther` text area.
4. Insert the `EmotionPicker` so users can tap to select multiple emotions and still get localized labels from the taxonomy file.
5. Gate the `foodEaten` `TextArea` on `entry.entryType` and `behavior` so skipping is respected, then forward the full payload to `onComplete`.
6. Keep the taxonomy translations in sync between English and Dutch so the shared UI components can resolve the same keys in both locales.

## 6. Acceptance Criteria

- [x] Option arrays for entry type, location, company, and behavior are defined in `options.ts` and typed against the Firestore enums ([options.ts](apps/food-diary/src/components/EntryForm/utils/options.ts)).
- [x] `ChipSelector` renders the entry-type chips so the user can switch between `breakfast`, `lunch`, `dinner`, `snack`, and `moment` selections.
- [x] Location and company inputs use the shared `Select` component with translated placeholders, and they show an "other" `TextArea` when the user picks `anders`.
- [x] `EmotionPicker` provides multi-select emotion chips whose labels are translated through `messages/en/entry/taxonomy.json` and `messages/nl/entry/taxonomy.json`.
- [x] Behavior selection is a multi-select `ChipSelector` that includes the `skipped meal` option and wires `behaviorOther` back into the entry state when needed.
- [x] The `skipped meal` flag and the `entryType === "moment"` guard both skip the `foodEaten` requirement when submitting the form, otherwise `foodEaten` must be filled.
- [x] Translation entries for every option exist in both English and Dutch taxonomy files so the UI can render localized labels.

## 7. Notes

- The original story called for a `TagGroup` and a dedicated `Switch` for skipped meals, but the current implementation reuses `ChipSelector` and `EmotionPicker` since those already cover grouping and tagging behaviors while keeping the UI consistent.
- Bookmark toggling is still handled via the `ToggleButtonGroup`, which sits alongside the inputs declared above.
